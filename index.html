<!DOCTYPE html>
<html lang="ar">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Luffy Pixel Mobile</title>
    <style>
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; overflow: hidden; background: #87CEEB; font-family: sans-serif; }
        canvas { display: block; touch-action: none; }
        #ui { position: absolute; top: 20%; width: 100%; text-align: center; color: white; text-shadow: 2px 2px 5px #000; pointer-events: none; }
        #score { position: absolute; top: 20px; left: 20px; font-size: 30px; color: gold; font-weight: bold; }
    </style>
</head>
<body>

    <div id="ui">
        <h1 id="msg">المس الشاشة لتبدأ المغامرة</h1>
    </div>
    <div id="score">0</div>
    <canvas id="gameCanvas"></canvas>

    <script>
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const msg = document.getElementById('msg');
        const scoreEl = document.getElementById('score');

        // ضبط الحجم
        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        let isPlaying = false;
        let score = 0;
        let obstacles = [];
        let gameSpeed = 5;
        const gravity = 0.8;

        const luffy = {
            x: 50,
            y: 0,
            w: 60,
            h: 80,
            dy: 0,
            jumpForce: -16,
            grounded: false,
            // مصفوفة البكسلات للوفي (1:أحمر، 2:بشرة، 3:أسود، 4:أزرق، 5:أصفر)
            map: [
                [0,0,5,5,5,5,0],
                [0,5,5,5,5,5,5],
                [0,3,3,3,3,3,0],
                [0,3,2,3,2,3,0],
                [0,2,2,2,2,2,0],
                [0,0,1,1,1,0,0],
                [0,0,1,1,1,0,0],
                [0,0,4,0,4,0,0]
            ],
            draw() {
                const pSize = 10;
                this.map.forEach((row, ri) => {
                    row.forEach((p, ci) => {
                        if (p === 0) return;
                        ctx.fillStyle = ["", "#FF0000", "#FFDBAC", "#000", "#00F", "#FFD700"][p];
                        ctx.fillRect(this.x + ci * pSize, this.y + ri * pSize, pSize, pSize);
                    });
                });
            },
            update() {
                let ground = canvas.height - 50;
                if (this.y + this.h < ground) {
                    this.dy += gravity;
                    this.grounded = false;
                } else {
                    this.dy = 0;
                    this.grounded = true;
                    this.y = ground - this.h;
                }
                this.y += this.dy;
                this.draw();
            }
        };

        function spawnObstacle() {
            if (Math.random() < 0.02) {
                if (obstacles.length === 0 || canvas.width - obstacles[obstacles.length-1].x > 300) {
                    obstacles.push({ x: canvas.width, w: 40, h: 50 });
                }
            }
        }

        function loop() {
            if (!isPlaying) return;
            ctx.clearRect(0, 0, canvas.width, canvas.height);

            // الخلفية والأرضية
            ctx.fillStyle = "#87CEEB"; ctx.fillRect(0,0,canvas.width,canvas.height);
            ctx.fillStyle = "#E67E22"; ctx.fillRect(0, canvas.height - 50, canvas.width, 50);

            luffy.update();
            spawnObstacle();

            obstacles.forEach((obs, i) => {
                obs.x -= gameSpeed;
                ctx.fillStyle = "#2C3E50"; 
                ctx.fillRect(obs.x, canvas.height - 100, obs.w, obs.h);

                // كشف التصادم
                if (luffy.x < obs.x + obs.w && luffy.x + luffy.w > obs.x && luffy.y + luffy.h > canvas.height - 100) {
                    isPlaying = false;
                    msg.innerHTML = "خسرت! <br> المس الشاشة للإعادة";
                    document.getElementById('ui').style.display = "block";
                }

                if (obs.x + obs.w < 0) {
                    obstacles.splice(i, 1);
                    score++;
                    gameSpeed += 0.2;
                    scoreEl.innerText = score;
                }
            });

            requestAnimationFrame(loop);
        }

        // التحكم باللمس والماوس
        function action() {
            if (!isPlaying) {
                isPlaying = true;
                score = 0;
                obstacles = [];
                gameSpeed = 5;
                scoreEl.innerText = "0";
                document.getElementById('ui').style.display = "none";
                loop();
            } else if (luffy.grounded) {
                luffy.dy = luffy.jumpForce;
            }
        }

        window.addEventListener('pointerdown', (e) => {
            e.preventDefault();
            action();
        });

        // الرسم الأولي
        ctx.fillStyle = "#87CEEB";
        ctx.fillRect(0,0,canvas.width,canvas.height);
        luffy.y = canvas.height - 130;
        luffy.draw();

    </script>
</body>
</html>

